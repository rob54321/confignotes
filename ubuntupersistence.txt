There are two types of persistence for ubuntu live systems.

1. persistent partition.
   Format a second parition on the live drive and label it casper-rw.
   it can be formated as ext4.
   it must be blank except for a lost+found directory.
   No persistence.conf like in debian.
   The main boot parition can also be ext4 using grub to boot it.
   In the grub boot parameter persistent must be used.

The grub.cfg is as follows:

#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/05_debian_theme ###
set menu_color_normal=cyan/blue
set menu_color_highlight=white/blue
### END /etc/grub.d/05_debian_theme ###

### BEGIN /etc/grub.d/10_linux ###
menuentry 'Ubuntu Linux rescue 18.10'  {
	set root='hd0,msdos1'
	echo	'Loading Linux rescue 4.18.0-10-generic ...'
	linux	/casper/vmlinuz boot=casper persistent live-media-path=/casper/ ignore_uuid nomodeset locale=en_ZA.UTF-8 timezone=Africa/Johannesburg noprompt quickreboot utc=no hostname=live username=robert ip=frommedia
	echo	'Loading initial ramdisk ...'
	initrd	/casper/initrd
}

### END /etc/grub.d/10_linux ###


2. Using casper-rw files instead.
   Here the main boot parition must be fat32 where the boot files, vmlinuz etc
   and casper-rw reside.

  To make the casper-rw:
  dd if=/dev/zero of=casper-rw bs=1M count=1000

  format it with mkfs.ext4 -v -j -F casper-rw
  Place it in casper directory with filesystem.squashfs, vmlinuz, initrd
  
  There can be a casper, casper1, casper2 directories each with it's own
  casper-rw, filesystem.squashfs, vmlinuz and initrd to boot different
  versions.

  There can also be more than one fat32 partition
  first with casper, casper1, second partition with casper3, casper4 etc.

To boot use the following grub.cfg:

#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/05_debian_theme ###
set menu_color_normal=cyan/blue
set menu_color_highlight=white/blue
### END /etc/grub.d/05_debian_theme ###

### BEGIN /etc/grub.d/10_linux ###
menuentry 'Ubuntu Linux rescue 18.10'  {
	set root='hd0,msdos2'
	echo	'Loading Linux rescue 4.18.0-10-generic ...'
	linux	/casper/vmlinuz boot=casper persistent persistent-path=/casper/ live-media-path=/casper/ ignore_uuid nomodeset locale=en_ZA.UTF-8 timezone=Africa/Johannesburg noprompt quickreboot utc=no hostname=live username=robert ip=frommedia
	echo	'Loading initial ramdisk ...'
	initrd	/casper/initrd
}
menuentry 'Ubuntu Mate 18.10'  {
	set root='hd0,msdos2'
	echo	'Loading Ubuntu Mate 18.10 ...'
	linux	/casper1/vmlinuz boot=casper persistent persistent-path=/casper1/ live-media-path=/casper1/ ignore_uuid locale=en_ZA.UTF-8 timezone=Africa/Johannesburg noprompt quickreboot utc=no hostname=live username=robert ip=frommedia
	echo	'Loading initial ramdisk ...'
	initrd	/casper1/initrd
}
menuentry 'Ubuntu 18.10'  {
	set root='hd0,msdos3'
	echo	'Loading Ubuntu 18.10 ...'
	linux	/casper2/vmlinuz boot=casper persistent persistent-path=/casper2/ live-media-path=/casper2/ ignore_uuid locale=en_ZA.UTF-8 timezone=Africa/Johannesburg noprompt quickreboot utc=no hostname=live username=robert ip=frommedia
	echo	'Loading initial ramdisk ...'
	initrd	/casper2/initrd
}
menuentry 'Windows Recovery Environment (on /dev/sda1)' --class windows --class os $menuentry_id_option 'osprober-chain-AED6-434E' {
	insmod part_msdos
	insmod fat
	set root='hd0,msdos1'
	if [ x$feature_platform_search_hint = xy ]; then
	  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1  AED6-434E
	else
	  search --no-floppy --fs-uuid --set=root AED6-434E
	fi
	parttool ${root} hidden-
	drivemap -s (hd0) ${root}
	chainloader +1
}

### END /etc/grub.d/10_linux ###

